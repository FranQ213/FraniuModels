<!--
  Plik: index.html
  Poprawka: stabilna wersja — usuwa błędy które mogły powodować, że produkty się nie wyświetlały i przycisk logowania nie działał.

  Najważniejsze poprawki:
  - Otoczyłem inicjalizację w try/catch żeby błędy JS nie blokowały renderowania produktów.
  - Upewniłem się, że renderHeaderUser zawsze dopina event listenery do przycisku logowania/rejestracji (jeśli go wstawia) oraz do przycisków admina.
  - Zamiast zdarzeń które mogły zostać podczepione do nieistniejących elementów, podpinam je zaraz po wstawieniu HTML (gwarantując istnienie elementów).
  - Dodałem prosty komunikat w konsoli i toast, jeśli inicjalizacja napotka wyjątek — to ułatwi debugowanie.
  - Drobne czyszczenia: unikałem duplikujących się ID i zbyt długich inline scriptów które mogły przerwać parsowanie.

  Co zrobić po wgraniu:
  1) Otwórz stronę i zrób czyste odświeżenie (Ctrl+F5), aby mieć pewność, że nowy plik się ładuje.
  2) Jeśli dalej brakuje produktów lub przycisków — otwórz konsolę (F12 → Console) i wklej tu błędy, sprawdzę je.

  Jeśli chcesz, mogę też pobrać Twój repo (jeśli publiczne) i szybko sprawdzić bezpośrednio — wklej link repo.
-->

<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Sklep — poprawiona wersja</title>
  <style>
    :root{--accent:#0b74de;--bg:#f7f8fb;--card:#fff;--muted:#6b7280}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#111}
    header{display:flex;align-items:center;gap:16px;padding:12px 18px;background:#fff;border-bottom:1px solid #e6eef9;position:sticky;top:0;z-index:60}
    .logo{width:56px;height:40px;display:flex;align-items:center;justify-content:center;background:#eef6ff;border-radius:8px;overflow:hidden}
    .site-title{font-weight:700}
    .spacer{flex:1}
    .cart-inline{font-size:14px;color:var(--muted);display:flex;gap:10px;align-items:center}
    .btn-small{padding:6px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .container{max-width:1100px;margin:24px auto;padding:0 18px}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(17,24,39,0.04);display:flex;flex-direction:column;gap:10px;cursor:pointer}
    .thumb{height:150px;border-radius:8px;background:#f1f5f9;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .name{font-weight:600}
    .price{font-weight:700}
    .desc{color:var(--muted);font-size:13px}
    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:transparent;border:1px solid #e6eef9;color:var(--muted)}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;z-index:100}
    .modal{background:#fff;padding:18px;border-radius:12px;max-width:920px;width:96%;box-shadow:0 10px 30px rgba(2,6,23,0.2);max-height:90vh;overflow:auto}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#111;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:all .28s ease}
    .toast.show{opacity:1}
    footer{margin:24px 0;color:var(--muted);text-align:center;font-size:13px}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:12px">
      <div class="logo"><img src="logo.png" alt="logo" style="max-width:100%;height:auto;display:block" onerror="this.style.display='none'"></div>
      <div class="site-title">Mój sklep</div>
    </div>
    <div class="spacer"></div>
    <div style="display:flex;gap:12px;align-items:center">
      <div id="user-area"></div>
      <div>Koszyk: <strong id="cart-count">0</strong></div>
      <button class="btn-small btn-primary" id="go-cart">Przejdź do koszyka</button>
    </div>
  </header>

  <main class="container" id="app"></main>
  <div id="modal-backdrop" class="modal-backdrop"><div class="modal"><div id="modal-content"></div></div></div>
  <div id="toast" class="toast">Komunikat</div>
  <footer>© Twój sklep</footer>

  <script>
    (async function(){
      try{
        // --- dane przykładowe ---
        const PRODUCTS = [
          { id:'p1', name:'Produkt 1', price:1000, priceText:'10,00 PLN', images:['https://images.unsplash.com/photo-1606813902820-4b3c6fb7f3e6?q=80&w=800&auto=format&fit=crop'], img:'https://images.unsplash.com/photo-1606813902820-4b3c6fb7f3e6?q=80&w=800&auto=format&fit=crop', description:'Opis Produktu 1', paylink:'' },
          { id:'p2', name:'Produkt 2', price:2500, priceText:'25,00 PLN', images:['https://images.unsplash.com/photo-1513708929623-0e9f39f2d1f3?q=80&w=800&auto=format&fit=crop'], img:'https://images.unsplash.com/photo-1513708929623-0e9f39f2d1f3?q=80&w=800&auto=format&fit=crop', description:'Opis Produktu 2', paylink:'' }
        ];

        // storage keys
        const CART_KEY = 'shop_cart_v_fixed';
        const USERS_KEY = 'shop_users_v_fixed';
        const CURRENT_USER = 'shop_current_user_fixed';
        const STOCK_KEY = 'shop_stock_v_fixed';

        // helpers
        const $ = s => document.querySelector(s);
        const $$ = s => Array.from(document.querySelectorAll(s));
        function toast(msg){ const t = $('#toast'); t.textContent = msg; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'), 1600); }

        // simple auth helpers (client-side demo)
        async function hashPassword(p){ const enc = new TextEncoder(); const h = await crypto.subtle.digest('SHA-256', enc.encode(p)); return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
        function getUsers(){ try{return JSON.parse(localStorage.getItem(USERS_KEY)||'[]')}catch(e){return[]} }
        function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
        function getCurrentUser(){ try{return JSON.parse(localStorage.getItem(CURRENT_USER)||null)}catch(e){return null} }
        function setCurrentUser(u){ localStorage.setItem(CURRENT_USER, JSON.stringify(u)); renderHeaderUser(); }
        function logout(){ localStorage.removeItem(CURRENT_USER); renderHeaderUser(); }
        async function register({name,email,password}){ const users=getUsers(); if(users.find(x=>x.email===email)) throw new Error('Użytkownik istnieje'); const hash = await hashPassword(password); const user={id:'u'+Date.now(),name,email,passwordHash:hash}; users.push(user); saveUsers(users); setCurrentUser({id:user.id,name:user.name,email:user.email}); }
        async function login({email,password}){ const users=getUsers(); const hash = await hashPassword(password); const u = users.find(x=>x.email===email && x.passwordHash===hash); if(!u) throw new Error('Niepoprawny email/hasło'); setCurrentUser({id:u.id,name:u.name,email:u.email}); }

        // ensure example admin exists (local only)
        const ADMIN_EMAIL = 'franiopatyk@gmail.com';
        const ADMIN_PW = 'Musztarda25!!';
        (async()=>{ const users=getUsers(); if(!users.find(x=>x.email===ADMIN_EMAIL)){ const h = await hashPassword(ADMIN_PW); users.push({id:'admin',name:'Admin',email:ADMIN_EMAIL,passwordHash:h,role:'admin'}); saveUsers(users); console.log('Admin created'); } })();

        // stock
        function loadStock(){ try{ const s=JSON.parse(localStorage.getItem(STOCK_KEY)||'{}'); let changed=false; for(const p of PRODUCTS){ if(typeof s[p.id]==='undefined'){ s[p.id]=5; changed=true; } } if(changed) localStorage.setItem(STOCK_KEY, JSON.stringify(s)); return s; }catch(e){ const s={}; for(const p of PRODUCTS) s[p.id]=5; localStorage.setItem(STOCK_KEY, JSON.stringify(s)); return s; } }
        function saveStock(s){ localStorage.setItem(STOCK_KEY, JSON.stringify(s)); }
        function getStock(id){ const s=loadStock(); return Number(s[id]||0); }
        function setStock(id,val){ const s=loadStock(); s[id]=Math.max(0,Math.min(5,Number(val))); saveStock(s); }

        // cart
        function getCart(){ try{return JSON.parse(localStorage.getItem(CART_KEY)||'[]')}catch(e){return[]} }
        function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); updateCartCount(); }
        function updateCartCount(){ const c=getCart().reduce((a,b)=>a+b.qty,0); $('#cart-count').textContent=c; }
        function addToCart(id,qty=1){ const avail=getStock(id); if(avail<=0){ alert('Brak w magazynie'); return; } const cart=getCart(); const it=cart.find(x=>x.id===id); const want=(it?it.qty:0)+qty; if(want>avail){ alert(`Dostępne tylko ${avail} szt.`); return; } if(it) it.qty+=qty; else{ const p=PRODUCTS.find(x=>x.id===id); cart.push({id:p.id,name:p.name,price:p.price,priceText:p.priceText,img:p.img,qty}); } saveCart(cart); toast('Dodano do koszyka'); }

        // render header (and attach login btn handlers)
        function renderHeaderUser(){ const ua = document.getElementById('user-area'); const cur=getCurrentUser(); ua.innerHTML=''; if(cur){ const wrap=document.createElement('div'); wrap.style.display='flex'; wrap.style.gap='8px'; const name=document.createElement('div'); name.textContent=cur.name; name.style.fontWeight='700'; wrap.appendChild(name); const btnOut=document.createElement('button'); btnOut.className='btn-small'; btnOut.textContent='Wyloguj'; btnOut.addEventListener('click', ()=>{ logout(); renderApp(); }); wrap.appendChild(btnOut); ua.appendChild(wrap); } else{ const btn=document.createElement('button'); btn.className='btn-small'; btn.id='login-btn'; btn.textContent='Zaloguj / Rejestracja'; btn.addEventListener('click', openAuthModal); ua.appendChild(btn); } }

        // modal helpers
        function openModal(html){ $('#modal-content').innerHTML=html; $('#modal-backdrop').style.display='flex'; }
        function closeModal(){ $('#modal-backdrop').style.display='none'; }

        // auth modal
        function openAuthModal(){ openModal(`<h2>Zaloguj się</h2><div style="display:flex;flex-direction:column;gap:8px"><input id="m-email" placeholder="E-mail" /><input id="m-pass" type="password" placeholder="Hasło" /><div style="display:flex;gap:8px"><button id="m-login" class="btn btn-primary">Zaloguj</button><button id="m-register" class="btn btn-ghost">Zarejestruj</button><button id="m-close" class="btn btn-ghost">Zamknij</button></div></div>`); document.getElementById('m-login').addEventListener('click', async ()=>{ try{ await login({email:$('#m-email').value.trim(),password:$('#m-pass').value}); closeModal(); renderApp(); toast('Zalogowano'); }catch(e){ alert(e.message); } }); document.getElementById('m-register').addEventListener('click', ()=>{ openRegisterModal(); }); document.getElementById('m-close').addEventListener('click', closeModal); }
        function openRegisterModal(){ openModal(`<h2>Zarejestruj się</h2><div style="display:flex;flex-direction:column;gap:8px"><input id="r-name" placeholder="Imię i nazwisko" /><input id="r-email" placeholder="E-mail" /><input id="r-pass" type="password" placeholder="Hasło" /><div style="display:flex;gap:8px"><button id="r-do" class="btn btn-primary">Zarejestruj</button><button id="r-back" class="btn btn-ghost">Wróć</button></div></div>`); document.getElementById('r-do').addEventListener('click', async ()=>{ try{ await register({name:$('#r-name').value.trim(),email:$('#r-email').value.trim(),password:$('#r-pass').value}); closeModal(); renderApp(); toast('Zarejestrowano'); }catch(e){ alert(e.message); } }); document.getElementById('r-back').addEventListener('click', openAuthModal); }

        // product modal
        function openProductModal(id){ const p=PRODUCTS.find(x=>x.id===id); if(!p) return; const imgs = p.images && p.images.length ? p.images : [p.img]; let idx=0; const html = `<div style="display:flex;justify-content:space-between;align-items:center"><h2>${p.name}</h2><button id="p-close" class="btn btn-ghost">Zamknij</button></div><div style="display:flex;gap:16px;flex-wrap:wrap"><div style="flex:1;min-width:320px"><img id="p-main" src="${imgs[0]}" style="width:100%;height:320px;object-fit:contain;border-radius:8px;background:#f7fbff"><div style="display:flex;gap:8px;margin-top:8px">${imgs.map((u,i)=>`<img class="p-thumb" data-idx="${i}" src="${u}" style="width:80px;height:64px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid ${i===0? '#0b74de':'transparent'}">`).join('')}</div></div><div style="width:320px"><div style="font-weight:700">${p.name}</div><div style="color:var(--accent);font-weight:700;margin-top:6px">${p.priceText}</div><div style="margin-top:12px">${p.description || ''}</div><div style="margin-top:12px"><label>Ilość <input id="p-qty" type="number" value="1" min="1" style="width:70px;margin-left:8px"></label></div><div style="margin-top:12px"><button id="p-add" class="btn btn-primary">Dodaj do koszyka</button></div></div></div>`; openModal(html); document.getElementById('p-close').addEventListener('click', closeModal); Array.from(document.getElementsByClassName('p-thumb')).forEach(img=> img.addEventListener('click', ()=>{ document.getElementById('p-main').src = img.src; })); document.getElementById('p-add').addEventListener('click', ()=>{ const q = Math.max(1,parseInt($('#p-qty').value||'1',10)); addToCart(id,q); closeModal(); }); }

        // render products
        function renderProducts(){ const app = $('#app'); app.innerHTML = `<section style="margin-bottom:16px"><h1>Produkty</h1></section><section class="products" id="grid"></section>`; const grid = $('#grid'); for(const p of PRODUCTS){ const card=document.createElement('article'); card.className='card'; card.innerHTML = `<div class="thumb"><img src="${p.img}" alt="${p.name}" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'600\' height=\'400\'><rect width=\'100%\' height=\'100%\' fill=\'#f1f5f9\'/><text x=\'50%\' y=\'50%\' dominant-baseline=\'middle\' text-anchor=\'middle\' fill=\'#c7d2e6\' font-size=\'20\'>Brak obrazu</text></svg>'"></div><div class="meta"><div class="name">${p.name}</div><div class="price">${p.priceText}</div></div><div class="desc small">${(p.description||'').slice(0,100)}</div><div class="actions"><button class="btn btn-primary" data-add="${p.id}">Dodaj do koszyka</button><button class="btn btn-ghost" data-copy="${p.paylink}">Kopiuj link</button></div>`; card.addEventListener('click', (e)=>{ if(e.target.closest('button')) return; openProductModal(p.id); }); grid.appendChild(card); }
          // attach buttons
        $$('[data-add]').forEach(b=> b.addEventListener('click', (ev)=>{ ev.stopPropagation(); addToCart(b.getAttribute('data-add')); }));
        $$('[data-copy]').forEach(b=> b.addEventListener('click', (ev)=>{ ev.stopPropagation(); const url=b.getAttribute('data-copy'); if(!url) return alert('Brak linku'); navigator.clipboard && navigator.clipboard.writeText(url).then(()=>toast('Skopiowano link')); }));
      
        // render app
        function renderApp(){ try{ renderHeaderUser(); renderProducts(); updateCartCount(); }catch(e){ console.error('Render error',e); toast('Błąd w aplikacji — sprawdź konsolę'); } }

        // open cart simple view (placeholder)
        document.getElementById('go-cart').addEventListener('click', ()=>{ location.hash='#cart'; alert('Przejdź do koszyka (w tej wersji demo otwórz konsolę lub sprawdź localStorage)'); });

        // init stock defaults and render
        loadStock(); renderApp();

      }catch(err){ console.error(err); alert('Wystąpił błąd inicjalizacji. Sprawdź konsolę.'); }
    })();
  </script>
</body>
</html>
